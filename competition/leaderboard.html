<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© | Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø§Ø­Ø«Ø§Øª Ø§Ù„ØªØ£Ø³ÙŠØ³</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="competition.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .leaderboard-page {
            padding-top: 120px;
            background: linear-gradient(135deg, #f8f4ef 0%, #e8dfd6 100%);
            min-height: 100vh;
        }
        
        .leaderboard-hero {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-green) 100%);
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .leaderboard-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .leaderboard-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .leaderboard-filters {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-dark);
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .top-three {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        
        .top-player {
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            width: 250px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s;
        }
        
        .top-player:hover {
            transform: translateY(-10px);
        }
        
        .top-player.first {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .rank-badge-large {
            position: absolute;
            top: -15px;
            right: 50%;
            transform: translateX(50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .first .rank-badge-large {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .second .rank-badge-large {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
        }
        
        .third .rank-badge-large {
            background: linear-gradient(135deg, #CD7F32, #A0522D);
        }
        
        .player-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 5px solid;
            object-fit: cover;
        }
        
        .first .player-avatar {
            border-color: #FFD700;
        }
        
        .second .player-avatar {
            border-color: #C0C0C0;
        }
        
        .third .player-avatar {
            border-color: #CD7F32;
        }
        
        .player-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }
        
        .player-score {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-green);
            margin-bottom: 1rem;
        }
        
        .player-stats {
            display: flex;
            justify-content: space-around;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .full-leaderboard {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 2fr 1fr 1fr 1fr;
            padding: 1rem;
            background: var(--primary-dark);
            color: white;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .leaderboard-row {
            display: grid;
            grid-template-columns: 80px 2fr 1fr 1fr 1fr;
            padding: 1rem;
            border-bottom: 1px solid var(--light-gray);
            align-items: center;
            transition: background 0.3s;
        }
        
        .leaderboard-row:hover {
            background: var(--light-beige);
        }
        
        .rank-cell {
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .user-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .score-cell {
            font-weight: bold;
            color: var(--secondary-green);
            font-size: 1.2rem;
        }
        
        .level-cell .level-badge {
            background: var(--light-beige);
            color: var(--primary-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .accuracy-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .accuracy-bar {
            flex: 1;
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .accuracy-fill {
            height: 100%;
            background: linear-gradient(to right, var(--secondary-green), var(--accent-gold));
            border-radius: 4px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--light-gray);
            background: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .page-btn.active {
            background: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .page-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .user-highlight {
            background: linear-gradient(135deg, rgba(17, 61, 28, 0.1), rgba(141, 174, 73, 0.1)) !important;
            border-right: 5px solid var(--secondary-green);
            font-weight: bold;
        }
        
        .time-filter {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .time-btn {
            padding: 8px 20px;
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .time-btn.active {
            background: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }
        
        @media (max-width: 768px) {
            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 50px 2fr 1fr;
            }
            
            .level-cell, .accuracy-cell {
                display: none;
            }
            
            .top-player {
                width: 200px;
            }
            
            .top-player.first {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="../assets/images/logo.png" alt="Ø´Ø¹Ø§Ø± ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³" class="logo-img">
                <span class="logo-text">Ø±Ø­Ù„Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³</span>
            </div>
            
            <div class="nav-menu">
                <a href="../index.html" class="nav-link"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="../exhibits/" class="nav-link"><i class="fas fa-landmark"></i> Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶</a>
                <a href="index.html" class="nav-link"><i class="fas fa-trophy"></i> Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</a>
                <a href="leaderboard.html" class="nav-link active"><i class="fas fa-ranking-star"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</a>
                <a href="../games/" class="nav-link"><i class="fas fa-gamepad"></i> Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</a>
            </div>
        </div>
    </nav>

    <main class="leaderboard-page">
        <section class="leaderboard-hero">
            <div class="container">
                <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h1>
                <p>ØªØµÙØ­ÙŠ ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© "Ø¨Ø§Ø­Ø«Ø§Øª Ø§Ù„ØªØ£Ø³ÙŠØ³" ÙˆØªÙ†Ø§ÙØ³ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù…Ø©</p>
                
                <div class="time-filter">
                    <button class="time-btn active" data-range="daily">Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
                    <button class="time-btn" data-range="weekly">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
                    <button class="time-btn" data-range="monthly">Ø§Ù„Ø´Ù‡Ø±ÙŠ</button>
                    <button class="time-btn" data-range="all">Ø§Ù„ÙƒÙ„ÙŠ</button>
                </div>
            </div>
        </section>

        <div class="container">
            <!-- Ø£ÙØ¶Ù„ Ù£ Ù…Ø´Ø§Ø±ÙƒØ§Øª -->
            <div class="top-three" id="topThree">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>

            <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
            <div class="leaderboard-filters">
                <button class="filter-btn active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
                <button class="filter-btn" data-filter="history">Ø§Ù„ØªØ§Ø±ÙŠØ®</button>
                <button class="filter-btn" data-filter="geography">Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</button>
                <button class="filter-btn" data-filter="heritage">Ø§Ù„ØªØ±Ø§Ø«</button>
                <button class="filter-btn" data-filter="vision">Ø§Ù„Ø±Ø¤ÙŠØ©</button>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
            <div class="full-leaderboard">
                <div class="leaderboard-header">
                    <div class="header-cell">Ø§Ù„ØªØ±ØªÙŠØ¨</div>
                    <div class="header-cell">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div>
                    <div class="header-cell">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                    <div class="header-cell">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                    <div class="header-cell">Ø§Ù„Ø¯Ù‚Ø©</div>
                </div>

                <div class="leaderboard-body" id="leaderboardBody">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>

                <!-- ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ -->
                <div class="leaderboard-row user-highlight" id="currentUserRow">
                    <div class="rank-cell" id="userRank">--</div>
                    <div class="user-cell">
                        <img src="../assets/images/default-avatar.png" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="user-avatar-small">
                        <div>
                            <div id="userName">Ø²Ø§Ø¦Ø±</div>
                            <div class="user-level" id="userLevelDisplay">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: 0</div>
                        </div>
                    </div>
                    <div class="score-cell" id="userScoreDisplay">0</div>
                    <div class="level-cell">
                        <span class="level-badge" id="userLevelBadge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 0</span>
                    </div>
                    <div class="accuracy-cell">
                        <div class="accuracy-bar">
                            <div class="accuracy-fill" id="userAccuracyBar" style="width: 0%"></div>
                        </div>
                        <span id="userAccuracyText">0%</span>
                    </div>
                </div>

                <!-- Ø§Ù„ØªØ±Ù‚ÙŠÙ… -->
                <div class="pagination" id="pagination">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats-summary">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div>
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h3>
                        <p id="totalParticipants">1,347</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-trophy"></i>
                    <div>
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
                        <p id="totalPoints">458,920</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-question-circle"></i>
                    <div>
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
                        <p id="totalQuestions">15,280</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-container">
            <!-- Ù†ÙØ³ Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ø³Ø§Ø¨Ù‚ -->
        </div>
    </footer>

    <script src="../script.js"></script>
    <script src="quiz.js"></script>
    <script>
        // ÙƒÙˆØ¯ Ø®Ø§Øµ Ø¨Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©
        class Leaderboard {
            constructor() {
                this.currentRange = 'daily';
                this.currentFilter = 'all';
                this.currentPage = 1;
                this.pageSize = 20;
                this.leaderboardData = [];
                
                this.init();
            }
            
            async init() {
                await this.loadLeaderboardData();
                this.setupEventListeners();
                this.renderTopThree();
                this.renderLeaderboard();
                this.updateUserStats();
                this.renderPagination();
            }
            
            async loadLeaderboardData() {
                // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                this.leaderboardData = this.generateSampleData(100);
            }
            
            generateSampleData(count) {
                const names = [
                    'Ù†ÙˆØ±Ø© Ø£Ø­Ù…Ø¯', 'Ø³Ø§Ø±Ø© Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠ', 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', 'Ù„Ø·ÙŠÙØ© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', 'Ù…Ù‡Ø§ Ø§Ù„Ø³Ø¯ÙŠØ±ÙŠ',
                    'Ø£Ù…Ù„ Ø§Ù„Ø±Ø´ÙŠØ¯', 'Ù‡Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù„ÙŠ', 'Ø±Ø­Ù…Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ', 'Ø´Ù‡Ø¯ Ø§Ù„Ù†Ø§ÙØ¹', 'Ø¬ÙˆØ§Ù‡Ø± Ø§Ù„Ù…Ø§Ù†Ø¹',
                    'ÙˆÙØ§Ø¡ Ø§Ù„Ø´Ù…Ø±ÙŠ', 'Ø¥ÙŠÙ†Ø§Ø³ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ', 'Ø¨ØªÙˆÙ„ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ', 'Ø¬Ù†Ù‰ Ø§Ù„Ù‚ØµÙŠØ±', 'Ø¯ÙŠÙ…Ø© Ø§Ù„Ø±Ø§ÙˆÙŠ',
                    'Ø±ÙŠÙ…Ø§Ø³ Ø§Ù„Ø¹ÙˆÙÙŠ', 'Ø³Ø¬Ù‰ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ', 'ØºØ§Ø¯Ø© Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ', 'ÙÙˆØ²ÙŠØ© Ø§Ù„Ø¨Ù„ÙˆÙŠ', 'Ù„ÙŠÙ†Ø§ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ'
                ];
                
                const data = [];
                
                for (let i = 1; i <= count; i++) {
                    const randomName = names[Math.floor(Math.random() * names.length)];
                    const points = 1000 - (i * 10) + Math.floor(Math.random() * 100);
                    const accuracy = 70 + Math.floor(Math.random() * 30);
                    const quizzes = 20 + Math.floor(Math.random() * 30);
                    const level = Math.floor(points / 1000) + 1;
                    
                    data.push({
                        rank: i,
                        name: randomName + (i > names.length ? ` ${Math.floor(i / names.length) + 1}` : ''),
                        points: points,
                        level: level,
                        accuracy: accuracy,
                        quizzes: quizzes,
                        avatar: `../assets/images/avatar${(i % 10) + 1}.png`,
                        lastActive: this.getRandomDate(),
                        categories: this.getRandomCategories()
                    });
                }
                
                return data;
            }
            
            getRandomDate() {
                const today = new Date();
                const daysAgo = Math.floor(Math.random() * 30);
                const date = new Date(today);
                date.setDate(date.getDate() - daysAgo);
                return date.toISOString().split('T')[0];
            }
            
            getRandomCategories() {
                const categories = ['history', 'geography', 'heritage', 'culture', 'vision'];
                const selected = [];
                const count = Math.floor(Math.random() * 3) + 2;
                
                for (let i = 0; i < count; i++) {
                    const randomCat = categories[Math.floor(Math.random() * categories.length)];
                    if (!selected.includes(randomCat)) {
                        selected.push(randomCat);
                    }
                }
                
                return selected;
            }
            
            setupEventListeners() {
                // ÙÙ„Ø§ØªØ± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
                document.querySelectorAll('.time-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.currentRange = btn.dataset.range;
                        this.filterAndRender();
                    });
                });
                
                // ÙÙ„Ø§ØªØ± Ø§Ù„ÙØ¦Ø§Øª
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.currentFilter = btn.dataset.filter;
                        this.filterAndRender();
                    });
                });
            }
            
            filterAndRender() {
                const filteredData = this.filterData();
                this.renderLeaderboard(filteredData);
                this.renderTopThree(filteredData);
                this.renderPagination(filteredData.length);
            }
            
            filterData() {
                let filtered = [...this.leaderboardData];
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
                if (this.currentFilter !== 'all') {
                    filtered = filtered.filter(user => 
                        user.categories.includes(this.currentFilter)
                    );
                }
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
                if (this.currentRange !== 'all') {
                    const today = new Date();
                    let daysLimit = 0;
                    
                    switch (this.currentRange) {
                        case 'daily':
                            daysLimit = 1;
                            break;
                        case 'weekly':
                            daysLimit = 7;
                            break;
                        case 'monthly':
                            daysLimit = 30;
                            break;
                    }
                    
                    if (daysLimit > 0) {
                        filtered = filtered.filter(user => {
                            const lastActive = new Date(user.lastActive);
                            const diffTime = today - lastActive;
                            const diffDays = diffTime / (1000 * 60 * 60 * 24);
                            return diffDays <= daysLimit;
                        });
                    }
                }
                
                return filtered;
            }
            
            renderTopThree(data = null) {
                if (!data) {
                    data = this.filterData();
                }
                
                const topThree = data.slice(0, 3);
                const topThreeContainer = document.getElementById('topThree');
                
                if (topThree.length === 0) {
                    topThreeContainer.innerHTML = '<p class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>';
                    return;
                }
                
                topThreeContainer.innerHTML = topThree.map((user, index) => {
                    const rankClass = ['first', 'second', 'third'][index];
                    const rankText = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index];
                    
                    return `
                        <div class="top-player ${rankClass}">
                            <div class="rank-badge-large">${rankText}</div>
                            <img src="${user.avatar}" alt="${user.name}" class="player-avatar">
                            <div class="player-name">${user.name}</div>
                            <div class="player-score">${user.points.toLocaleString('ar-SA')}</div>
                            <div class="player-stats">
                                <div>
                                    <div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                                    <div class="stat-value">${user.level}</div>
                                </div>
                                <div>
                                    <div>Ø§Ù„Ø¯Ù‚Ø©</div>
                                    <div class="stat-value">${user.accuracy}%</div>
                                </div>
                                <div>
                                    <div>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</div>
                                    <div class="stat-value">${user.quizzes}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            renderLeaderboard(data = null) {
                if (!data) {
                    data = this.filterData();
                }
                
                const startIndex = (this.currentPage - 1) * this.pageSize;
                const endIndex = startIndex + this.pageSize;
                const pageData = data.slice(startIndex, endIndex);
                
                const leaderboardBody = document.getElementById('leaderboardBody');
                
                if (pageData.length === 0) {
                    leaderboardBody.innerHTML = `
                        <div class="no-data-message">
                            <i class="fas fa-search"></i>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
                            <p>Ø¬Ø±Ø¨ÙŠ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„ØªØ± Ø£Ùˆ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ</p>
                        </div>
                    `;
                    return;
                }
                
                leaderboardBody.innerHTML = pageData.map(user => {
                    const isCurrentUser = this.isCurrentUser(user);
                    const rowClass = isCurrentUser ? 'user-highlight' : '';
                    
                    return `
                        <div class="leaderboard-row ${rowClass}">
                            <div class="rank-cell">${user.rank}</div>
                            <div class="user-cell">
                                <img src="${user.avatar}" alt="${user.name}" class="user-avatar-small">
                                <div>
                                    <div class="user-name">${user.name}</div>
                                    <div class="user-categories">
                                        ${user.categories.map(cat => `
                                            <span class="category-tag">${this.getCategoryName(cat)}</span>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            <div class="score-cell">${user.points.toLocaleString('ar-SA')}</div>
                            <div class="level-cell">
                                <span class="level-badge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${user.level}</span>
                            </div>
                            <div class="accuracy-cell">
                                <div class="accuracy-bar">
                                    <div class="accuracy-fill" style="width: ${user.accuracy}%"></div>
                                </div>
                                <span class="accuracy-value">${user.accuracy}%</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            renderPagination(totalItems = null) {
                if (!totalItems) {
                    const data = this.filterData();
                    totalItems = data.length;
                }
                
                const totalPages = Math.ceil(totalItems / this.pageSize);
                const paginationContainer = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    paginationContainer.innerHTML = '';
                    return;
                }
                
                let paginationHTML = '';
                
                // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
                if (this.currentPage > 1) {
                    paginationHTML += `
                        <button class="page-btn" onclick="leaderboard.changePage(${this.currentPage - 1})">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    `;
                }
                
                // Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª
                const maxVisiblePages = 5;
                let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                        <button class="page-btn ${i === this.currentPage ? 'active' : ''}" 
                                onclick="leaderboard.changePage(${i})">
                            ${i.toLocaleString('ar-SA')}
                        </button>
                    `;
                }
                
                // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
                if (this.currentPage < totalPages) {
                    paginationHTML += `
                        <button class="page-btn" onclick="leaderboard.changePage(${this.currentPage + 1})">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    `;
                }
                
                paginationContainer.innerHTML = paginationHTML;
            }
            
            changePage(page) {
                this.currentPage = page;
                const data = this.filterData();
                this.renderLeaderboard(data);
                this.renderPagination(data.length);
                window.scrollTo({ top: 400, behavior: 'smooth' });
            }
            
            updateUserStats() {
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
                const userData = JSON.parse(localStorage.getItem('user') || '{}');
                const quizProgress = JSON.parse(localStorage.getItem('userQuizProgress') || '{}');
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (userData.name) {
                    document.getElementById('userName').textContent = userData.name;
                    document.getElementById('userScoreDisplay').textContent = userData.points?.toLocaleString('ar-SA') || '0';
                    
                    const level = Math.floor((userData.points || 0) / 1000) + 1;
                    document.getElementById('userLevelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${level}`;
                    document.getElementById('userLevelBadge').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level}`;
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚Ø©
                    let accuracy = 0;
                    if (quizProgress.correctAnswers && quizProgress.totalQuestions) {
                        accuracy = Math.round((quizProgress.correctAnswers / quizProgress.totalQuestions) * 100);
                    }
                    
                    document.getElementById('userAccuracyBar').style.width = `${accuracy}%`;
                    document.getElementById('userAccuracyText').textContent = `${accuracy}%`;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨
                    this.updateUserRank(userData);
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                this.updateGeneralStats();
            }
            
            updateUserRank(userData) {
                // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userRank = Math.floor(Math.random() * 50) + 1;
                document.getElementById('userRank').textContent = userRank;
            }
            
            updateGeneralStats() {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                const totalParticipants = this.leaderboardData.length;
                const totalPoints = this.leaderboardData.reduce((sum, user) => sum + user.points, 0);
                const totalQuestions = totalParticipants * 25; // ØªÙ‚Ø¯ÙŠØ±ÙŠ
                
                document.getElementById('totalParticipants').textContent = totalParticipants.toLocaleString('ar-SA');
                document.getElementById('totalPoints').textContent = totalPoints.toLocaleString('ar-SA');
                document.getElementById('totalQuestions').textContent = totalQuestions.toLocaleString('ar-SA');
            }
            
            getCategoryName(categoryId) {
                const categories = {
                    'history': 'Ø§Ù„ØªØ§Ø±ÙŠØ®',
                    'geography': 'Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§',
                    'heritage': 'Ø§Ù„ØªØ±Ø§Ø«',
                    'culture': 'Ø§Ù„Ø«Ù‚Ø§ÙØ©',
                    'vision': 'Ø§Ù„Ø±Ø¤ÙŠØ©'
                };
                
                return categories[categoryId] || categoryId;
            }
            
            isCurrentUser(user) {
                const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
                return user.name === currentUser.name;
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©
        let leaderboard;
        document.addEventListener('DOMContentLoaded', () => {
            leaderboard = new Leaderboard();
        });
        
        // ØªØµØ¯ÙŠØ± Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        window.Leaderboard = Leaderboard;
    </script>
</body>
</html>
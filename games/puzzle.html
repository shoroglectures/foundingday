<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุจุงุฒู ุงูุฒููู | ุฑุญูุฉ ุงูุชุฃุณูุณ</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="games.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ุดุฑูุท ุงูุชููู -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="../assets/images/logo.png" alt="ุดุนุงุฑ ููู ุงูุชุฃุณูุณ" class="logo-img">
                <span class="logo-text">ุฑุญูุฉ ุงูุชุฃุณูุณ</span>
            </div>
            
            <div class="nav-menu">
                <a href="../index.html" class="nav-link"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a>
                <a href="../exhibits/" class="nav-link"><i class="fas fa-landmark"></i> ุงููุนุงุฑุถ</a>
                <a href="../competition/" class="nav-link"><i class="fas fa-trophy"></i> ุงููุณุงุจูุฉ</a>
                <a href="puzzle.html" class="nav-link active"><i class="fas fa-puzzle-piece"></i> ุงูุจุงุฒู ุงูุฒููู</a>
                <a href="drawing.html" class="nav-link"><i class="fas fa-palette"></i> ุฃุฑุณู ุชุงุฑูุฎู</a>
                <a href="photo-booth.html" class="nav-link"><i class="fas fa-camera"></i> ุฃูุง ูุทูู</a>
            </div>
        </div>
    </nav>

    <!-- ุฑุฃุณ ุตูุญุฉ ุงููุนุจุฉ -->
    <header class="game-header">
        <div class="header-content">
            <h1 class="game-title">ุงูุจุงุฒู ุงูุฒููู</h1>
            <p class="game-subtitle">ุฑุชุจ ูุทุน ุงูุจุงุฒู ูุงูุชุดุงู ุตูุฑ ุชุงุฑูุฎูุฉ ูููุฉ ูู ุชุงุฑูุฎ ุงูููููุฉ</p>
            
            <div class="game-info">
                <div class="info-card">
                    <i class="fas fa-clock"></i>
                    <div>
                        <h4>ุงููุณุชูู ุงูุญุงูู</h4>
                        <p id="currentLevel">ุงููุณุชูู ูก</p>
                    </div>
                </div>
                
                <div class="info-card">
                    <i class="fas fa-star"></i>
                    <div>
                        <h4>ุงูููุงุท</h4>
                        <p id="gamePoints">ู</p>
                    </div>
                </div>
                
                <div class="info-card">
                    <i class="fas fa-trophy"></i>
                    <div>
                        <h4>ุฃูุถู ูุชูุฌุฉ</h4>
                        <p id="highScore">ู</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ููุทูุฉ ุงููุนุจุฉ ุงูุฑุฆูุณูุฉ -->
    <main class="game-main">
        <div class="container">
            <div class="game-layout">
                <!-- ููุญุฉ ุงูุชุญูู -->
                <aside class="game-controls">
                    <div class="controls-section">
                        <h3>ุงูุตุนูุจุฉ</h3>
                        <div class="difficulty-selector">
                            <button class="diff-btn active" data-difficulty="easy">ุณูู (ูฃรูฃ)</button>
                            <button class="diff-btn" data-difficulty="medium">ูุชูุณุท (ูครูค)</button>
                            <button class="diff-btn" data-difficulty="hard">ุตุนุจ (ูฅรูฅ)</button>
                        </div>
                    </div>
                    
                    <div class="controls-section">
                        <h3>ุงูููุถูุน</h3>
                        <div class="theme-selector">
                            <button class="theme-btn active" data-theme="historical">
                                <i class="fas fa-landmark"></i>
                                <span>ุชุงุฑูุฎู</span>
                            </button>
                            
                            <button class="theme-btn" data-theme="cultural">
                                <i class="fas fa-archway"></i>
                                <span>ุชุฑุงุซู</span>
                            </button>
                            
                            <button class="theme-btn" data-theme="modern">
                                <i class="fas fa-city"></i>
                                <span>ุญุฏูุซ</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="controls-section">
                        <h3>ุงููุคูุช</h3>
                        <div class="timer-display">
                            <i class="fas fa-hourglass-half"></i>
                            <span id="gameTimer">ููข:ูู</span>
                        </div>
                        
                        <div class="timer-controls">
                            <button class="btn-small" onclick="pauseTimer()">
                                <i class="fas fa-pause"></i> ุฅููุงู
                            </button>
                            
                            <button class="btn-small" onclick="resetTimer()">
                                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ
                            </button>
                        </div>
                    </div>
                    
                    <div class="controls-section">
                        <h3>ุงูุชูููุญุงุช</h3>
                        <div class="hint-counter">
                            <span>ุงููุชุจูู: <span id="hintsLeft">ูฃ</span></span>
                            <button class="btn-small" onclick="useHint()" id="hintBtn">
                                <i class="fas fa-lightbulb"></i> ุงุณุชุฎุฏู ุชูููุญ
                            </button>
                        </div>
                        
                        <div class="hint-types">
                            <button class="hint-type" data-hint="preview" onclick="showPreview()">
                                <i class="fas fa-eye"></i> ูุนุงููุฉ
                            </button>
                            
                            <button class="hint-type" data-hint="swap" onclick="suggestSwap()">
                                <i class="fas fa-exchange-alt"></i> ุชุจุฏูู
                            </button>
                            
                            <button class="hint-type" data-hint="solve" onclick="solvePiece()">
                                <i class="fas fa-magic"></i> ุญู ูุทุนุฉ
                            </button>
                        </div>
                    </div>
                    
                    <div class="game-stats">
                        <h3>ุงูุฅุญุตุงุฆูุงุช</h3>
                        <div class="stats-grid">
                            <div class="stat">
                                <span class="stat-label">ุงููุทุน ุงููุฑุชุจุฉ:</span>
                                <span class="stat-value" id="placedPieces">ู</span>
                            </div>
                            
                            <div class="stat">
                                <span class="stat-label>ุงููุญุงููุงุช:</span>
                                <span class="stat-value" id="movesCount">ู</span>
                            </div>
                            
                            <div class="stat">
                                <span class="stat-label">ุงูุฏูุฉ:</span>
                                <span class="stat-value" id="accuracyRate">ููช</span>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- ููุทูุฉ ุงููุนุจุฉ -->
                <div class="game-area">
                    <div class="game-header">
                        <div class="level-info">
                            <h2 id="puzzleTitle">ูุตุฑ ุงููุตูู</h2>
                            <p id="puzzleDescription">ููุนุฉ ุชุงุฑูุฎูุฉ ูู ุงูุฑูุงุถุ ุดูุฏุช ุงุณุชุนุงุฏุชูุง ุนุงู ูกูฉููข</p>
                        </div>
                        
                        <div class="game-actions">
                            <button class="btn-primary" onclick="startNewGame()">
                                <i class="fas fa-play"></i> ุจุฏุก ุฌุฏูุฏ
                            </button>
                            
                            <button class="btn-secondary" onclick="toggleSound()" id="soundBtn">
                                <i class="fas fa-volume-up"></i> ุงูุตูุช
                            </button>
                            
                            <button class="btn-secondary" onclick="showInstructions()">
                                <i class="fas fa-question-circle"></i> ุงููุณุงุนุฏุฉ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ููุทูุฉ ุงูุจุงุฒู -->
                    <div class="puzzle-container">
                        <div class="puzzle-board" id="puzzleBoard">
                            <!-- ุณูุชู ุฅูุดุงุก ุงูุจุงุฒู ุฏููุงููููุงู -->
                        </div>
                        
                        <div class="puzzle-pieces" id="puzzlePieces">
                            <!-- ูุทุน ุงูุจุงุฒู ุณุชุธูุฑ ููุง -->
                        </div>
                    </div>
                    
                    <!-- ูุนูููุงุช ุงููุทุนุฉ -->
                    <div class="piece-info" id="pieceInfo">
                        <h3>ูุนูููุงุช ุนู ุงูุตูุฑุฉ</h3>
                        <div id="pieceDescription">
                            ุงุฎุชุฑ ูุทุนุฉ ูุนุฑุถ ูุนูููุงุช ุนููุง
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ูุงูุฐุฉ ุงูุชุนูููุงุช -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeInstructions()">&times;</span>
            
            <div class="instructions-content">
                <h2>ููููุฉ ูุนุจ ุงูุจุงุฒู ุงูุฒููู</h2>
                
                <div class="instruction-step">
                    <div class="step-number">ูก</div>
                    <div class="step-content">
                        <h3>ุงุฎุชูุงุฑ ุงูุตุนูุจุฉ ูุงูููุถูุน</h3>
                        <p>ุงุฎุชุฑ ูุณุชูู ุงูุตุนูุจุฉ (ุณููุ ูุชูุณุทุ ุตุนุจ) ูุงูููุถูุน ุงูุฐู ุชูุถูููู (ุชุงุฑูุฎูุ ุชุฑุงุซูุ ุญุฏูุซ).</p>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">ูข</div>
                    <div class="step-content">
                        <h3>ุชุฑุชูุจ ุงููุทุน</h3>
                        <p>ุงุณุญุจู ุงููุทุน ูู ุงูููุทูุฉ ุงูุณูููุฉ ุฅูู ููุงูุนูุง ุงูุตุญูุญุฉ ุนูู ุงูููุญุฉ. ูู ูุทุนุฉ ูู ููุงููุง ุงูุตุญูุญ ุชุถูู ููุงุทุงู.</p>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">ูฃ</div>
                    <div class="step-content">
                        <h3>ุงุณุชุฎุฏุงู ุงูุชูููุญุงุช</h3>
                        <p>ุงุณุชุฎุฏูู ุงูุชูููุญุงุช ุงููุชุงุญุฉ ูููุณุงุนุฏุฉ ูู ุญู ุงูุจุงุฒู. ูุฏูู ูฃ ุชูููุญุงุช ููู ูุณุชูู.</p>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">ูค</div>
                    <div class="step-content">
                        <h3>ุงูุชูุงู ุงูุตูุฑุฉ</h3>
                        <p>ุนูุฏ ุงูุชูุงู ุงูุตูุฑุฉุ ุณุชุธูุฑ ูุนูููุงุช ุชุงุฑูุฎูุฉ ุนู ุงูุตูุฑุฉ ูุชูุณุจูู ููุงุทุงู ุฅุถุงููุฉ ุจูุงุกู ุนูู ุงูุณุฑุนุฉ ูุงูุฏูุฉ.</p>
                    </div>
                </div>
                
                <div class="game-tips">
                    <h3>ูุตุงุฆุญ ููููุฒ</h3>
                    <ul>
                        <li>ุงุจุฏุฆู ุจุงูุฃุทุฑุงู ูุงูุฒูุงูุง</li>
                        <li>ุฑูุฒู ุนูู ุงูุฃููุงู ูุงูุชุดุงุจูุงุช</li>
                        <li>ุงุณุชุฎุฏูู ุงูุชูููุญุงุช ุจุญููุฉ</li>
                        <li>ุฑุงูุจู ุงูููุช ุฌูุฏุงู</li>
                    </ul>
                </div>
                
                <button class="btn-primary" onclick="closeInstructions()">
                    ูููุชุ ููุฃุจุฏุฃ ุงููุนุจ!
                </button>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุงููุชุงุฆุฌ -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="results-content">
                <div class="results-header">
                    <i class="fas fa-trophy"></i>
                    <h2>๐ ุฃุญุณูุช! ๐</h2>
                    <p>ููุฏ ุฃุชููุช ุงูุจุงุฒู ุจูุฌุงุญ</p>
                </div>
                
                <div class="results-stats">
                    <div class="result-stat">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h4>ุงูููุช</h4>
                            <p class="stat-value" id="resultTime">ูู:ูู</p>
                        </div>
                    </div>
                    
                    <div class="result-stat">
                        <div class="stat-icon">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <div class="stat-info">
                            <h4>ุงููุทุน</h4>
                            <p class="stat-value" id="resultPieces">ู</p>
                        </div>
                    </div>
                    
                    <div class="result-stat">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h4>ุงูููุงุท</h4>
                            <p class="stat-value" id="resultPoints">ู</p>
                        </div>
                    </div>
                    
                    <div class="result-stat">
                        <div class="stat-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="stat-info">
                            <h4>ุงูููุงุกุฉ</h4>
                            <p class="stat-value" id="resultEfficiency">ููช</p>
                        </div>
                    </div>
                </div>
                
                <div class="results-breakdown">
                    <h3>ุชูุตูู ุงูููุงุท</h3>
                    <div class="breakdown-list">
                        <div class="breakdown-item">
                            <span>ุฅููุงู ุงูุจุงุฒู:</span>
                            <span class="points">+ูฅูู ููุทุฉ</span>
                        </div>
                        
                        <div class="breakdown-item">
                            <span>ููุงูุฃุฉ ุงูุณุฑุนุฉ:</span>
                            <span class="points" id="speedBonus">+ู ููุทุฉ</span>
                        </div>
                        
                        <div class="breakdown-item">
                            <span>ููุงูุฃุฉ ุงูุฏูุฉ:</span>
                            <span class="points" id="accuracyBonus">+ู ููุทุฉ</span>
                        </div>
                        
                        <div class="breakdown-item total">
                            <span>ุงููุฌููุน:</span>
                            <span class="points" id="totalPoints">ู ููุทุฉ</span>
                        </div>
                    </div>
                </div>
                
                <div class="puzzle-info">
                    <h3>ุนู ุงูุตูุฑุฉ</h3>
                    <div id="completedImageInfo">
                        <!-- ูุนูููุงุช ุงูุตูุฑุฉ ุงูููุชููุฉ -->
                    </div>
                </div>
                
                <div class="results-actions">
                    <button class="btn-primary" onclick="nextPuzzle()">
                        <i class="fas fa-forward"></i> ุงูุจุงุฒู ุงูุชุงูู
                    </button>
                    
                    <button class="btn-secondary" onclick="sharePuzzleResult()">
                        <i class="fas fa-share"></i> ุดุงุฑู ุงููุชูุฌุฉ
                    </button>
                    
                    <button class="btn-secondary" onclick="retryPuzzle()">
                        <i class="fas fa-redo"></i> ุญุงูู ูุฑุฉ ุฃุฎุฑู
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ุงูููุชุฑ -->
    <footer>
        <div class="footer-container">
            <!-- ููุณ ุงูููุชุฑ ุงูุณุงุจู -->
        </div>
    </footer>

    <script src="../script.js"></script>
    <script src="games.js"></script>
    <script>
        // ููุฏ ุฎุงุต ุจูุนุจุฉ ุงูุจุงุฒู ุงูุฒููู
        class PuzzleGame {
            constructor() {
                this.gridSize = 3;
                this.difficulty = 'easy';
                this.theme = 'historical';
                this.pieces = [];
                this.board = [];
                this.currentLevel = 1;
                this.points = 0;
                this.highScore = 0;
                this.timer = 120;
                this.timerInterval = null;
                this.hintsLeft = 3;
                this.movesCount = 0;
                this.placedPieces = 0;
                this.gameStarted = false;
                this.soundEnabled = true;
                
                this.init();
            }
            
            init() {
                this.loadGameState();
                this.setupEventListeners();
                this.loadPuzzleData();
                this.createNewPuzzle();
                this.updateUI();
                
                // ุชุญููู ุฃูุถู ูุชูุฌุฉ
                const savedHighScore = localStorage.getItem('puzzleHighScore');
                if (savedHighScore) {
                    this.highScore = parseInt(savedHighScore);
                    document.getElementById('highScore').textContent = this.highScore;
                }
            }
            
            loadPuzzleData() {
                this.puzzles = {
                    historical: [
                        {
                            id: 1,
                            title: "ูุตุฑ ุงููุตูู",
                            description: "ููุนุฉ ุชุงุฑูุฎูุฉ ูู ุงูุฑูุงุถุ ุดูุฏุช ูุนุฑูุฉ ุงุณุชุนุงุฏุฉ ุงูุฑูุงุถ ุนุงู ูกูฉููขู ุนูู ูุฏ ุงูููู ุนุจุฏุงูุนุฒูุฒ ุขู ุณุนูุฏ.",
                            image: "assets/images/masmak.jpg",
                            year: "ูกูฉููขู",
                            pieces: 9,
                            points: 500,
                            fact: "ุจุงุจ ุงููุตุฑ ูุง ูุฒุงู ูุญูู ุขุซุงุฑ ุงูุฑูุญ ุงูุฐู ููุชู ุนููู ุงุจู ุฑุดูุฏ."
                        },
                        {
                            id: 2,
                            title: "ุงูุฏุฑุนูุฉ ุงูุชุงุฑูุฎูุฉ",
                            description: "ุนุงุตูุฉ ุงูุฏููุฉ ุงูุณุนูุฏูุฉ ุงูุฃููู ูุฃูู ุนุงุตูุฉ ููุฏููุฉ ุงูุณุนูุฏูุฉ.",
                            image: "assets/images/diriyah.jpg",
                            year: "ูกูงูขูงู",
                            pieces: 16,
                            points: 750,
                            fact: "ุฃุฏุฑุฌุช ุงูุฏุฑุนูุฉ ูู ูุงุฆูุฉ ุงููููุณูู ููุชุฑุงุซ ุงูุนุงููู ุนุงู ูขููกูู."
                        }
                    ],
                    cultural: [
                        // ุจุงุฒู ุชุฑุงุซูุฉ
                    ],
                    modern: [
                        // ุจุงุฒู ุญุฏูุซุฉ
                    ]
                };
            }
            
            createNewPuzzle() {
                // ุชุญุฏูุฏ ุงูุจุงุฒู ุจูุงุกู ุนูู ุงูููุถูุน ูุงููุณุชูู
                const themePuzzles = this.puzzles[this.theme];
                const puzzle = themePuzzles[this.currentLevel - 1] || themePuzzles[0];
                
                // ุชุนููู ุญุฌู ุงูุดุจูุฉ ุจูุงุกู ุนูู ุงูุตุนูุจุฉ
                this.gridSize = this.difficulty === 'easy' ? 3 : 
                               this.difficulty === 'medium' ? 4 : 5;
                
                // ุชููุฆุฉ ุงูููุญุฉ
                this.board = Array(this.gridSize * this.gridSize).fill(null);
                this.pieces = [];
                
                // ุฅูุดุงุก ูุทุน ุงูุจุงุฒู
                this.createPuzzlePieces(puzzle);
                
                // ุฎูุท ุงููุทุน
                this.shufflePieces();
                
                // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
                this.updatePuzzleUI(puzzle);
            }
            
            createPuzzlePieces(puzzle) {
                // ูู ุงููุงูุนุ ููุง ูุฌุจ ุชูุณูู ุงูุตูุฑุฉ ุฅูู ูุทุน
                // ููููุง ุณูุญุงูู ุฐูู ูุนุฏู ูุฌูุฏ ูุญุฑุฑ ุตูุฑ ูู ุงููุชุตูุญ
                
                for (let i = 0; i < this.gridSize * this.gridSize; i++) {
                    this.pieces.push({
                        id: i,
                        correctPosition: i,
                        currentPosition: null,
                        row: Math.floor(i / this.gridSize),
                        col: i % this.gridSize,
                        image: `${puzzle.image}_${i}.jpg`,
                        isPlaced: false
                    });
                }
            }
            
            shufflePieces() {
                // ุฎูุท ุงููุทุน ุนุดูุงุฆูุงู
                for (let i = this.pieces.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.pieces[i], this.pieces[j]] = [this.pieces[j], this.pieces[i]];
                }
            }
            
            updatePuzzleUI(puzzle) {
                document.getElementById('puzzleTitle').textContent = puzzle.title;
                document.getElementById('puzzleDescription').textContent = puzzle.description;
                document.getElementById('currentLevel').textContent = `ุงููุณุชูู ${this.currentLevel}`;
                
                // ุชุญุฏูุซ ููุทูุฉ ุงูุจุงุฒู
                this.renderPuzzleBoard();
                this.renderPuzzlePieces();
            }
            
            renderPuzzleBoard() {
                const boardDiv = document.getElementById('puzzleBoard');
                boardDiv.innerHTML = '';
                boardDiv.style.gridTemplateColumns = `repeat(${this.gridSize}, 1fr)`;
                
                for (let i = 0; i < this.gridSize * this.gridSize; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'puzzle-cell';
                    cell.dataset.index = i;
                    
                    // ุฅุฐุง ูุงูุช ููุงู ูุทุนุฉ ูู ูุฐุง ุงูููุถุน
                    const piece = this.board[i];
                    if (piece !== null) {
                        const pieceDiv = this.createPieceElement(piece);
                        cell.appendChild(pieceDiv);
                    }
                    
                    cell.addEventListener('dragover', (e) => e.preventDefault());
                    cell.addEventListener('drop', (e) => this.dropPiece(e, i));
                    
                    boardDiv.appendChild(cell);
                }
            }
            
            renderPuzzlePieces() {
                const piecesDiv = document.getElementById('puzzlePieces');
                piecesDiv.innerHTML = '';
                
                // ุนุฑุถ ุงููุทุน ุบูุฑ ุงููุฑุจูุทุฉ
                const unplacedPieces = this.pieces.filter(p => !p.isPlaced);
                
                unplacedPieces.forEach(piece => {
                    const pieceDiv = this.createPieceElement(piece);
                    pieceDiv.draggable = true;
                    pieceDiv.addEventListener('dragstart', (e) => this.dragPiece(e, piece.id));
                    
                    piecesDiv.appendChild(pieceDiv);
                });
            }
            
            createPieceElement(piece) {
                const pieceDiv = document.createElement('div');
                pieceDiv.className = 'puzzle-piece';
                pieceDiv.dataset.id = piece.id;
                pieceDiv.dataset.correct = piece.correctPosition;
                
                // ูู ุงููุดุฑูุน ุงูุญููููุ ููุง ูุฌุจ ุนุฑุถ ุฌุฒุก ูู ุงูุตูุฑุฉ
                // ููููุง ุณูุนุฑุถ ุฑูู ูุคูุช
                pieceDiv.innerHTML = `
                    <div class="piece-number">${piece.id + 1}</div>
                    <div class="piece-overlay">
                        <i class="fas fa-arrows-alt"></i>
                    </div>
                `;
                
                pieceDiv.addEventListener('click', () => this.showPieceInfo(piece.id));
                
                return pieceDiv;
            }
            
            dragPiece(event, pieceId) {
                event.dataTransfer.setData('pieceId', pieceId.toString());
                
                if (this.soundEnabled) {
                    this.playSound('drag');
                }
            }
            
            dropPiece(event, cellIndex) {
                event.preventDefault();
                
                const pieceId = parseInt(event.dataTransfer.getData('pieceId'));
                this.placePiece(pieceId, cellIndex);
            }
            
            placePiece(pieceId, cellIndex) {
                if (this.board[cellIndex] !== null) {
                    // ุงูุฎููุฉ ูุดุบููุฉ
                    this.showFeedback('ุงูุฎููุฉ ูุดุบููุฉ!', 'warning');
                    return;
                }
                
                const piece = this.pieces.find(p => p.id === pieceId);
                if (!piece) return;
                
                // ูุถุน ุงููุทุนุฉ ุนูู ุงูููุญุฉ
                this.board[cellIndex] = piece;
                piece.isPlaced = true;
                piece.currentPosition = cellIndex;
                
                this.placedPieces++;
                this.movesCount++;
                
                // ุงูุชุญูู ุฅุฐุง ูุงูุช ูู ุงูููุงู ุงูุตุญูุญ
                const isCorrect = cellIndex === piece.correctPosition;
                
                if (isCorrect) {
                    this.points += 10;
                    this.showFeedback('ูุทุนุฉ ูู ููุงููุง ุงูุตุญูุญ! ๐', 'success');
                    
                    if (this.soundEnabled) {
                        this.playSound('correct');
                    }
                } else {
                    this.showFeedback('ุงููุทุนุฉ ููุณุช ูู ููุงููุง ุงูุตุญูุญ', 'warning');
                }
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                this.updateUI();
                this.renderPuzzleBoard();
                this.renderPuzzlePieces();
                
                // ุงูุชุญูู ูู ุงูุชูุงู ุงูุจุงุฒู
                this.checkPuzzleComplete();
                
                // ุญูุธ ุชูุฏู ุงููุนุจุฉ
                this.saveGameState();
            }
            
            checkPuzzleComplete() {
                // ุงูุชุญูู ุฅุฐุง ุชู ูุถุน ุฌููุน ุงููุทุน
                const allPiecesPlaced = this.pieces.every(piece => piece.isPlaced);
                
                if (!allPiecesPlaced) return;
                
                // ุงูุชุญูู ุฅุฐุง ูุงูุช ุฌููุน ุงููุทุน ูู ุฃูุงูููุง ุงูุตุญูุญุฉ
                const allCorrect = this.pieces.every(piece => 
                    piece.currentPosition === piece.correctPosition
                );
                
                if (allCorrect) {
                    this.completePuzzle();
                }
            }
            
            completePuzzle() {
                clearInterval(this.timerInterval);
                
                // ุญุณุงุจ ุงูููุงุท ุงูุฅุถุงููุฉ
                const timeBonus = Math.max(0, 500 - this.timer);
                const accuracyBonus = Math.floor((this.placedPieces / this.movesCount) * 100);
                const levelBonus = this.currentLevel * 100;
                
                const totalPoints = this.points + timeBonus + accuracyBonus + levelBonus;
                
                // ุชุญุฏูุซ ุฃุนูู ูุชูุฌุฉ
                if (totalPoints > this.highScore) {
                    this.highScore = totalPoints;
                    localStorage.setItem('puzzleHighScore', this.highScore);
                }
                
                // ุนุฑุถ ุงููุชุงุฆุฌ
                this.showResults(totalPoints, timeBonus, accuracyBonus);
                
                // ุชุญุฏูุซ ููุงุท ุงููุณุชุฎุฏู ุงูุนุงูุฉ
                this.updateUserPoints(totalPoints);
            }
            
            showResults(totalPoints, timeBonus, accuracyBonus) {
                document.getElementById('resultTime').textContent = 
                    this.formatTime(120 - this.timer);
                document.getElementById('resultPieces').textContent = 
                    `${this.placedPieces}/${this.gridSize * this.gridSize}`;
                document.getElementById('resultPoints').textContent = totalPoints;
                document.getElementById('resultEfficiency').textContent = 
                    `${Math.floor((this.placedPieces / this.movesCount) * 100)}%`;
                
                document.getElementById('speedBonus').textContent = `+${timeBonus} ููุทุฉ`;
                document.getElementById('accuracyBonus').textContent = `+${accuracyBonus} ููุทุฉ`;
                document.getElementById('totalPoints').textContent = `${totalPoints} ููุทุฉ`;
                
                // ุนุฑุถ ูุนูููุงุช ุงูุตูุฑุฉ
                const puzzle = this.puzzles[this.theme][this.currentLevel - 1];
                document.getElementById('completedImageInfo').innerHTML = `
                    <h4>${puzzle.title}</h4>
                    <p>${puzzle.description}</p>
                    <div class="fact-box">
                        <i class="fas fa-lightbulb"></i>
                        <strong>ูุนูููุฉ:</strong> ${puzzle.fact}
                    </div>
                `;
                
                // ุนุฑุถ ูุงูุฐุฉ ุงููุชุงุฆุฌ
                document.getElementById('resultsModal').style.display = 'flex';
            }
            
            startTimer() {
                clearInterval(this.timerInterval);
                
                this.timerInterval = setInterval(() => {
                    this.timer--;
                    this.updateTimerDisplay();
                    
                    if (this.timer <= 0) {
                        clearInterval(this.timerInterval);
                        this.gameOver();
                    }
                }, 1000);
            }
            
            updateTimerDisplay() {
                const minutes = Math.floor(this.timer / 60);
                const seconds = this.timer % 60;
                
                document.getElementById('gameTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateUI() {
                document.getElementById('gamePoints').textContent = this.points;
                document.getElementById('placedPieces').textContent = 
                    `${this.placedPieces}/${this.gridSize * this.gridSize}`;
                document.getElementById('movesCount').textContent = this.movesCount;
                document.getElementById('accuracyRate').textContent = 
                    this.movesCount > 0 ? 
                    `${Math.floor((this.placedPieces / this.movesCount) * 100)}%` : 
                    'ููช';
                document.getElementById('hintsLeft').textContent = this.hintsLeft;
            }
            
            useHint() {
                if (this.hintsLeft <= 0) {
                    this.showFeedback('ูุง ุชูุฌุฏ ุชูููุญุงุช ูุชุงุญุฉ', 'warning');
                    return;
                }
                
                this.hintsLeft--;
                this.showFeedback('ุชู ุงุณุชุฎุฏุงู ุชูููุญ', 'info');
                this.updateUI();
                
                // ุชูููุฐ ุชุฃุซูุฑ ุงูุชูููุญ
                this.highlightCorrectPiece();
            }
            
            highlightCorrectPiece() {
                // ุฅูุฌุงุฏ ูุทุนุฉ ุบูุฑ ูุซุจุชุฉ ูู ููุงููุง ุงูุตุญูุญ
                const misplacedPiece = this.pieces.find(piece => 
                    piece.isPlaced && piece.currentPosition !== piece.correctPosition
                );
                
                if (misplacedPiece) {
                    // ุชุณููุท ุงูุถูุก ุนูู ุงููุทุนุฉ
                    const pieceElement = document.querySelector(`[data-id="${misplacedPiece.id}"]`);
                    if (pieceElement) {
                        pieceElement.classList.add('hint-highlight');
                        
                        setTimeout(() => {
                            pieceElement.classList.remove('hint-highlight');
                        }, 2000);
                    }
                }
            }
            
            showPieceInfo(pieceId) {
                const piece = this.pieces.find(p => p.id === pieceId);
                if (!piece) return;
                
                const infoDiv = document.getElementById('pieceInfo');
                infoDiv.innerHTML = `
                    <h3>ูุนูููุงุช ุนู ุงููุทุนุฉ</h3>
                    <div class="piece-details">
                        <p><strong>ุงูุฑูู:</strong> ${piece.id + 1}</p>
                        <p><strong>ุงูููุงู ุงูุตุญูุญ:</strong> ุงูุตู ${piece.row + 1}ุ ุงูุนููุฏ ${piece.col + 1}</p>
                        <p><strong>ุงูุญุงูุฉ:</strong> ${piece.isPlaced ? 'ูุซุจุชุฉ' : 'ุบูุฑ ูุซุจุชุฉ'}</p>
                    </div>
                `;
            }
            
            setupEventListeners() {
                // ุงุฎุชูุงุฑ ุงูุตุนูุจุฉ
                document.querySelectorAll('.diff-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.difficulty = btn.dataset.difficulty;
                        this.resetGame();
                    });
                });
                
                // ุงุฎุชูุงุฑ ุงูููุถูุน
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.theme = btn.dataset.theme;
                        this.currentLevel = 1;
                        this.resetGame();
                    });
                });
            }
            
            resetGame() {
                clearInterval(this.timerInterval);
                
                this.points = 0;
                this.timer = 120;
                this.hintsLeft = 3;
                this.movesCount = 0;
                this.placedPieces = 0;
                this.gameStarted = false;
                
                this.createNewPuzzle();
                this.updateUI();
                this.updateTimerDisplay();
            }
            
            startNewGame() {
                this.gameStarted = true;
                this.startTimer();
                this.showFeedback('ุงุจุฏุฃ! ุญุธุงู ููููุงู', 'success');
            }
            
            saveGameState() {
                const gameState = {
                    difficulty: this.difficulty,
                    theme: this.theme,
                    currentLevel: this.currentLevel,
                    points: this.points,
                    hintsLeft: this.hintsLeft,
                    timer: this.timer,
                    movesCount: this.movesCount,
                    placedPieces: this.placedPieces,
                    board: this.board,
                    pieces: this.pieces
                };
                
                localStorage.setItem('puzzleGameState', JSON.stringify(gameState));
            }
            
            loadGameState() {
                const savedState = localStorage.getItem('puzzleGameState');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    
                    this.difficulty = state.difficulty;
                    this.theme = state.theme;
                    this.currentLevel = state.currentLevel;
                    this.points = state.points;
                    this.hintsLeft = state.hintsLeft;
                    this.timer = state.timer;
                    this.movesCount = state.movesCount;
                    this.placedPieces = state.placedPieces;
                    this.board = state.board;
                    this.pieces = state.pieces;
                    
                    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงููุงุฌูุฉ
                    document.querySelectorAll('.diff-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.difficulty === this.difficulty);
                    });
                    
                    document.querySelectorAll('.theme-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.theme === this.theme);
                    });
                }
            }
            
            showFeedback(message, type) {
                // ููุณ ุฏุงูุฉ ุงูุฅุดุนุงุฑุงุช ุงูุณุงุจูุฉ
            }
            
            playSound(soundType) {
                // ูุญุงูุงุฉ ุงูุฃุตูุงุช
                const sounds = {
                    drag: new Audio('assets/audio/drag.mp3'),
                    correct: new Audio('assets/audio/correct.mp3'),
                    wrong: new Audio('assets/audio/wrong.mp3'),
                    complete: new Audio('assets/audio/complete.mp3')
                };
                
                if (sounds[soundType]) {
                    sounds[soundType].play().catch(() => {
                        // ุชุฌุงูู ุงูุฃุฎุทุงุก ุฅุฐุง ูู ูุชู ุชุญููู ุงูุตูุช
                    });
                }
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            updateUserPoints(points) {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (user.points) {
                    user.points += points;
                    localStorage.setItem('user', JSON.stringify(user));
                }
            }
        }
        
        // ุชููุฆุฉ ุงููุนุจุฉ
        let puzzleGame;
        document.addEventListener('DOMContentLoaded', () => {
            puzzleGame = new PuzzleGame();
        });
        
        // ูุธุงุฆู ุนุงูุฉ
        function startNewGame() {
            if (puzzleGame) {
                puzzleGame.startNewGame();
            }
        }
        
        function pauseTimer() {
            if (puzzleGame && puzzleGame.timerInterval) {
                clearInterval(puzzleGame.timerInterval);
                puzzleGame.timerInterval = null;
                puzzleGame.showFeedback('ุชู ุฅููุงู ุงููุคูุช', 'info');
            }
        }
        
        function resetTimer() {
            if (puzzleGame) {
                puzzleGame.timer = 120;
                puzzleGame.updateTimerDisplay();
                puzzleGame.showFeedback('ุชู ุฅุนุงุฏุฉ ุถุจุท ุงููุคูุช', 'info');
            }
        }
        
        function useHint() {
            if (puzzleGame) {
                puzzleGame.useHint();
            }
        }
        
        function showPreview() {
            if (puzzleGame) {
                puzzleGame.showFeedback('ูุนุงููุฉ ุงูุตูุฑุฉ ุงููุงููุฉ', 'info');
                // ูู ุงูุชูููุฐ ุงูุญููููุ ุนุฑุถ ุงูุตูุฑุฉ ุงููุงููุฉ ููุฏุฉ ุซุงููุชูู
            }
        }
        
        function suggestSwap() {
            if (puzzleGame) {
                puzzleGame.showFeedback('ุงูุชุฑุงุญ ุชุจุฏูู ูููุนูู', 'info');
                // ุงูุชุฑุงุญ ุชุจุฏูู ูุทุนุชูู
            }
        }
        
        function solvePiece() {
            if (puzzleGame && puzzleGame.hintsLeft > 0) {
                puzzleGame.hintsLeft--;
                puzzleGame.showFeedback('ุชู ุญู ูุทุนุฉ ูุงุญุฏุฉ', 'success');
                // ูุถุน ูุทุนุฉ ูู ููุงููุง ุงูุตุญูุญ
            }
        }
        
        function toggleSound() {
            if (puzzleGame) {
                puzzleGame.soundEnabled = !puzzleGame.soundEnabled;
                const btn = document.getElementById('soundBtn');
                const icon = btn.querySelector('i');
                
                if (puzzleGame.soundEnabled) {
                    icon.className = 'fas fa-volume-up';
                    btn.innerHTML = '<i class="fas fa-volume-up"></i> ุงูุตูุช';
                    puzzleGame.showFeedback('ุชู ุชุดุบูู ุงูุตูุช', 'info');
                } else {
                    icon.className = 'fas fa-volume-mute';
                    btn.innerHTML = '<i class="fas fa-volume-mute"></i> ุงูุตูุช';
                    puzzleGame.showFeedback('ุชู ุฅููุงู ุงูุตูุช', 'info');
                }
            }
        }
        
        function showInstructions() {
            document.getElementById('instructionsModal').style.display = 'flex';
        }
        
        function closeInstructions() {
            document.getElementById('instructionsModal').style.display = 'none';
        }
        
        function nextPuzzle() {
            if (puzzleGame) {
                puzzleGame.currentLevel++;
                puzzleGame.resetGame();
                document.getElementById('resultsModal').style.display = 'none';
            }
        }
        
        function sharePuzzleResult() {
            const points = document.getElementById('resultPoints').textContent;
            const level = puzzleGame.currentLevel;
            
            const shareText = `๐ฎ ุญุตูุช ุนูู ${points} ููุทุฉ ูู ุงููุณุชูู ${level} ูู ูุนุจุฉ ุงูุจุงุฒู ุงูุฒููู!\n\nุฌุฑุจูุง ุจููุณู ุนูู: ${window.location.origin}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ูุชูุฌุชู ูู ุงูุจุงุฒู ุงูุฒููู',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    puzzleGame.showFeedback('ุชู ูุณุฎ ุงููุชูุฌุฉ ูููุดุงุฑูุฉ', 'success');
                });
            }
        }
        
        function retryPuzzle() {
            if (puzzleGame) {
                puzzleGame.resetGame();
                document.getElementById('resultsModal').style.display = 'none';
                startNewGame();
            }
        }
    </script>
</body>
</html>